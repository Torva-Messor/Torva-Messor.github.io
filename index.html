<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>QR Innovation 2026</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/theme/black.min.css">
    <script type="module" src="https://ajax.googleapis.com/ajax/libs/model-viewer/3.4.0/model-viewer.min.js"></script>

    <style>
        :root { --blue: #00d4ff; --dark: #050505; }
        body { background: var(--dark); color: white; font-family: 'Inter', sans-serif; overflow: hidden; }

        /* Dynamische SchriftgrÃ¶ÃŸen */
        .reveal h1 { font-size: 12vw !important; font-weight: 900; letter-spacing: -0.05em; text-transform: none; }
        .reveal h2 { font-size: 6vw !important; color: var(--blue); text-transform: none; }
        .reveal p { font-size: 4vw !important; color: #aaa; }

        /* Flashy Background Glow */
        .glow-bg {
            position: fixed; width: 60vw; height: 60vw;
            background: radial-gradient(circle, rgba(0,212,255,0.15) 0%, rgba(0,0,0,0) 70%);
            top: 20%; left: 20%; filter: blur(80px); z-index: -1;
            animation: float 10s infinite alternate;
        }

        @keyframes float { from { transform: translate(0,0); } to { transform: translate(10%, 10%); } }

        /* QR Anatomy Visuals */
        .qr-box { 
            border: 2vw solid white; width: 25vw; height: 25vw; 
            display: flex; align-items: center; justify-content: center;
            box-shadow: 0 0 30px rgba(255,255,255,0.2);
        }
        .qr-inner { background: white; width: 50%; height: 50%; }

        /* UI Elements */
        #start-overlay { position: fixed; inset: 0; background: black; z-index: 1000; display: flex; justify-content: center; align-items: center; }
        #start-btn { 
            padding: 2.5vh 8vw; background: transparent; color: var(--blue); 
            border: 2px solid var(--blue); border-radius: 50px; font-size: 5vw;
            font-weight: bold; cursor: pointer; transition: 0.3s;
            box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);
        }
        
        #sync-status { position: fixed; top: 10px; right: 10px; font-size: 10px; opacity: 0.5; z-index: 100; }

        .fs-media { width: 100vw; height: 100vh; object-fit: contain; }
        .ar-btn { position: absolute; bottom: 10%; left: 50%; transform: translateX(-50%); padding: 15px 30px; background: white; color: black; border-radius: 30px; font-weight: bold; border: none; }
    </style>
</head>
<body>

    <div id="start-overlay"><button id="start-btn" onclick="initViewer()">SESSION BEITRETEN</button></div>
    <div id="sync-status">OFFSET: <span id="sync-val">0</span>ms</div>
    <div class="glow-bg"></div>

    <audio id="sync-audio" src="morse (2).mp3" preload="auto"></audio>

    <div class="reveal">
        <div class="slides">

            <section data-auto-animate>
                <h1 data-id="t">QR CODE</h1>
                <p data-id="s">Physische BinÃ¤r-VerschlÃ¼sselung</p>
            </section>

            <section data-auto-animate>
                <h2 data-id="t">DIE ANATOMIE</h2>
                <div style="display: flex; gap: 5vw; align-items: center; justify-content: center; margin-top: 5vh;">
                    <div class="qr-box fragment fade-up" data-fragment-index="1"><div class="qr-inner"></div></div>
                    <div class="fragment fade-up" data-fragment-index="2" style="border: 1vw solid var(--blue); width: 15vw; height: 15vw;"></div>
                </div>
                <div style="margin-top: 3vh;">
                    <span class="fragment" data-fragment-index="1">Position</span> â€¢ 
                    <span class="fragment" data-fragment-index="2">Ausrichtung</span>
                </div>
            </section>

            <section>
                <h2>REED-SOLOMON</h2>
                <h1 style="color: var(--blue);">LEVEL H</h1>
                [span_3](start_span)<p>Bis zu <b style="color:white;">30% Datenverlust</b> kompensierbar[span_3](end_span)</p>
            </section>

            <section>
                <p>Seit 1992</p>
                <h2>Masahiro Hara</h2>
                <p style="font-size: 3vw;">Inspiriert vom Go-Brettspiel</p>
            </section>

            <section data-background-color="#000">
                <video id="sync-video" class="fs-media" playsinline webkit-playsinline>
                    <source src="qr-code-pubnub-torva-project.mp4" type="video/mp4">
                </video>
            </section>

            <section data-background-color="#000">
                <model-viewer id="ar-element" class="fs-media" src="https://modelviewer.dev/shared-assets/models/Astronaut.glb" ar ar-modes="webxr scene-viewer quick-look" camera-controls auto-rotate>
                    <button slot="ar-button" class="ar-btn">ðŸš€ IN DEINEM RAUM PLATZIEREN</button>
                </model-viewer>
            </section>

        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.js"></script>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.6.3.min.js"></script>
    <script src="config.js"></script>

    <script>
        const deck = new Reveal();
        deck.initialize({ controls: false, progress: false, touch: false, transition: 'fade' });
        
        const video = document.getElementById("sync-video");
        const statusVal = document.getElementById("sync-val");
        let serverTimeOffset = 0;
        let currentStartTime = 0;

        async function initViewer() {
            document.getElementById("start-overlay").style.display = 'none';
            
            // Unlock Media
            const unlock = async (el) => { try { el.muted = true; await el.play(); el.pause(); el.currentTime = 0; el.muted = false; } catch(e){} };
            await unlock(video);

            const pubnub = new PubNub({ subscribeKey: Pub_Nub_api_Subscribe, userId: "u" + Math.random() });
            const res = await pubnub.time();
            serverTimeOffset = Math.floor(res.timetoken / 10000) - Date.now();

            pubnub.addListener({
                message: (m) => {
                    if (m.message.index !== undefined) {
                        deck.slide(m.message.index);
                        if (m.message.fragment !== undefined) {
                            while(deck.getIndices().f < m.message.fragment) deck.next();
                        }
                        currentStartTime = m.message.startTime;
                    }
                }
            });
            pubnub.subscribe({ channels: [My_Channel_Name] });

            setInterval(sync, 500);
        }

        function sync() {
            if (deck.getIndices().h !== 4 || !currentStartTime) return;
            const target = ((Date.now() + serverTimeOffset) - currentStartTime) / 1000;
            const diff = target - video.currentTime;
            
            if (Math.abs(diff) > 0.5) video.currentTime = target;
            else if (Math.abs(diff) > 0.1) video.playbackRate = diff > 0 ? 1.05 : 0.95;
            else video.playbackRate = 1.0;

            if (video.paused && target > 0) video.play();
            statusVal.innerText = Math.round(diff * 1000);
        }
    </script>
</body>
</html>
