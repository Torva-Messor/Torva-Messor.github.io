<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Torva Presenter</title>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.6.3.min.js"></script>
    <style>
        body { font-family: 'Inter', sans-serif; background: #111; color: #fff; display: flex; flex-direction: column; align-items: center; padding: 20px; margin: 0; }
        h1 { color: #00f2ff; font-size: 1.5rem; margin-bottom: 30px; text-align: center; letter-spacing: 2px; }
        
        .button-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; width: 100%; max-width: 400px; }
        
        button { 
            background: #222; border: 1px solid #444; color: white; 
            padding: 20px; border-radius: 10px; font-size: 1rem; 
            cursor: pointer; transition: all 0.2s; touch-action: manipulation;
            font-weight: bold;
        }
        button:active { transform: scale(0.95); background: #333; }
        
        .btn-action { border-color: #00f2ff; color: #00f2ff; }
        .btn-video { border-color: #fff; background: #333; color: #fff; }
        .btn-damage { border-color: #ff0055; color: #ff0055; }
        .btn-heal { border-color: #00ff88; color: #00ff88; }
        .btn-ar { border-color: #ffaa00; color: #ffaa00; }
        
        .full-width { grid-column: span 2; }
        #status { font-size: 0.8rem; color: #666; margin-top: 20px; font-family: monospace; }
    </style>
</head>
<body>

    <h1>TORVA CONTROL</h1>

    <div class="button-grid">
        <button class="btn-action" onclick="sendCommand(0, 'morph_go')">‚¨ÖÔ∏è 1. GO Brett</button>
        <button class="btn-action" onclick="sendCommand(1, 'morph_qr')">‚ú® 2. Activate QR</button>
        
        <button class="btn-damage" onclick="sendCommand(null, 'damage')">‚ö° ADD DAMAGE</button>
        <button class="btn-heal" onclick="sendCommand(null, 'heal')">‚ù§Ô∏è REPAIR ALL</button>
        
        <button class="btn-video full-width" onclick="sendVideoCommand('play')">üé• 3. VIDEO START (SYNC)</button>
        <button class="btn-video full-width" onclick="sendVideoCommand('stop')">‚èπÔ∏è STOP VIDEO</button>
        
        <button class="btn-ar full-width" onclick="sendCommand(3, 'ar_mode')">ü§ñ 4. AR OBJECT</button>
    </div>

    <div id="status">Ready</div>

    <script>
        const publishKey = 'pub-c-f5b11d3c-ddfe-4dfc-963e-6fae738aeb03'; 
        const subscribeKey = 'sub-c-6fdfc9e3-91b8-4f79-b62a-6fd9fc69eff7';
        const channelName = 'PrasiW.Woche';

        const pubnub = new PubNub({ publishKey, subscribeKey, userId: "presenter_mobile" });

        function sendCommand(slideIndex, actionName) {
            const payload = {};
            if (slideIndex !== null) payload.slide = slideIndex;
            if (actionName !== null) payload.action = actionName;
            publish(payload);
        }

        function sendVideoCommand(state) {
            // Future Timestamp + 2 Sekunden Puffer f√ºr perfekten Sync
            const futureTime = Date.now() + 2000;
            const payload = { 
                action: 'video_sync', 
                videoState: state, 
                startTime: futureTime 
            };
            publish(payload);
        }

        function publish(payload) {
            const statusEl = document.getElementById('status');
            statusEl.innerText = "Sending " + (payload.action || "Slide") + "...";
            pubnub.publish({ channel: channelName, message: payload }, (status) => {
                if (status.error) { 
                    statusEl.innerText = "Error"; statusEl.style.color = "red"; 
                } else { 
                    statusEl.innerText = "Sent"; statusEl.style.color = "#00ff88"; 
                    setTimeout(() => { statusEl.innerText = "Ready"; statusEl.style.color = "#666"; }, 1000); 
                }
            });
        }
    </script>
</body>
</html>
