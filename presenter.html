<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>PRESENTER CONTROL</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/theme/white.min.css">
</head>
<body>
    <div class="reveal">
        <div class="slides">
            <section><h1>Start</h1></section>
            <section><h3>Audio läuft jetzt bei allen...</h3></section>
            <section><h1>Test beendet</h1></section>
            <section><h3>AR Info</h3></section>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/4.5.0/reveal.min.js"></script>
    <script src="https://cdn.pubnub.com/sdk/javascript/pubnub.7.6.3.min.js"></script>
    <script src="config.js"></script>

    <script>
        const deck = new Reveal();
        deck.initialize({ hash: true, controls: true }); // Controls AN

        const pubnub = new PubNub({
            subscribeKey: Pub_Nub_api_Subscribe,
            publishKey: Pub_Nub_api_Publish, // WICHTIG: Hier muss der Publish Key rein!
            userId: "presenter_master"
        });

        // Wenn DU die Folie wechselst -> Sende Befehl an alle
        deck.on('slidechanged', async (event) => {
            const index = event.indexh;
            
            // Serverzeit holen für exakten Sync
            let startTime = null;
            if (index === 1) { // Wenn Schach-Folie (Index 1)
                try {
                    const t = await pubnub.time();
                    // Audio soll in 1 Sekunde starten (Puffer für Netzwerk)
                    startTime = Math.floor(t.timetoken / 10000) + 1000; 
                } catch(e) { startTime = Date.now() + 1000; }
            }

            // Befehl senden
            pubnub.publish({
                channel: My_Channel_Name,
                message: { 
                    index: index,
                    startTime: startTime // Wird nur gesendet wenn nicht null
                },
                storeInHistory: true // Wichtig für Späteinsteiger
            });
        });
    </script>
</body>
</html>
